# Sundry Debtors - Database & Usage Guide

## 📊 SQLite Table Structure

### Table: `sundry_debtors`

Located in each **client-specific database** (e.g., `sahil_petkar.db`)

```sql
CREATE TABLE sundry_debtors (
    id          TEXT PRIMARY KEY,           -- UUID (unique identifier)
    debtor_name TEXT NOT NULL,              -- Customer/Debtor name
    gstin       TEXT NOT NULL UNIQUE,       -- GST Number (15 chars)
    address     TEXT,                       -- Full address (optional)
    contact     TEXT,                       -- Phone number (optional)
    email       TEXT,                       -- Email address (optional)
    created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 🔑 Field Details

| Field | Type | Required | Description | Example |
|-------|------|----------|-------------|---------|
| `id` | TEXT | ✅ Yes | UUID generated by backend | `550e8400-e29b-41d4...` |
| `debtor_name` | TEXT | ✅ Yes | Customer/Company name | `ABC Company Limited` |
| `gstin` | TEXT | ✅ Yes | 15-character GST number (unique) | `29ABCDE1234F1Z5` |
| `address` | TEXT | ❌ No | Full postal address | `123 MG Road, Mumbai...` |
| `contact` | TEXT | ❌ No | Contact number | `9876543210` |
| `email` | TEXT | ❌ No | Email address | `contact@company.com` |
| `created_at` | TIMESTAMP | Auto | Record creation time | `2025-10-21 10:30:00` |
| `updated_at` | TIMESTAMP | Auto | Last modification time | `2025-10-21 15:45:00` |

## 📝 GSTIN Format

**Format**: `NNLLLLLNNNNLNLN`
- **NN**: 2-digit State Code (e.g., 29 for Karnataka)
- **LLLLL**: 5 letters of business name (PAN first 5)
- **NNNN**: 4 digits (PAN next 4)
- **L**: Letter (PAN last character)
- **N**: Number of registrations (1-9)
- **L**: Letter Z (default)
- **N**: Check digit

**Example**: `29ABCDE1234F1Z5`
- State: 29 (Karnataka)
- PAN: ABCDE1234F
- Registration: 1
- Default: Z
- Check: 5

## 🗄️ Database Location

```
sppro/
└── backend/
    └── client_databases/
        ├── sahil_petkar.db          ← Contains sundry_debtors table
        ├── company_xyz.db           ← Contains sundry_debtors table
        └── [client_name].db         ← Each client has separate database
```

## 🔍 Common Queries

### 1. Get All Debtors
```sql
SELECT * FROM sundry_debtors 
ORDER BY debtor_name ASC;
```

### 2. Search by Name
```sql
SELECT * FROM sundry_debtors 
WHERE LOWER(debtor_name) LIKE '%company%'
ORDER BY debtor_name;
```

### 3. Search by GSTIN
```sql
SELECT * FROM sundry_debtors 
WHERE gstin = '29ABCDE1234F1Z5';
```

### 4. Get Debtors for Autocomplete
```sql
SELECT id, debtor_name, gstin 
FROM sundry_debtors 
WHERE LOWER(debtor_name) LIKE '%abc%' 
   OR LOWER(gstin) LIKE '%abc%'
ORDER BY debtor_name
LIMIT 5;
```

### 5. Count Total Debtors
```sql
SELECT COUNT(*) as total FROM sundry_debtors;
```

## 🔧 API Endpoints

### Base URL: `http://127.0.0.1:5001/api`

### 1. **GET** - Fetch All Debtors
```
GET /clients/{client_id}/sundry-debtors
```

**Response**:
```json
[
  {
    "id": "uuid-here",
    "debtorName": "ABC Company",
    "gstin": "29ABCDE1234F1Z5",
    "address": "123 MG Road, Mumbai",
    "contact": "9876543210",
    "email": "contact@abc.com",
    "createdAt": "2025-10-21 10:30:00",
    "updatedAt": "2025-10-21 10:30:00"
  }
]
```

### 2. **POST** - Add New Debtor
```
POST /clients/{client_id}/sundry-debtors
```

**Request Body**:
```json
{
  "debtorName": "New Company Ltd",
  "gstin": "27NEWCO5678G2A1",
  "address": "456 Street, Delhi",
  "contact": "9123456789",
  "email": "info@newco.com"
}
```

**Response**:
```json
{
  "message": "Sundry debtor added successfully",
  "debtorId": "generated-uuid"
}
```

### 3. **PUT** - Update Debtor
```
PUT /clients/{client_id}/sundry-debtors/{debtor_id}
```

**Request Body**:
```json
{
  "debtorName": "Updated Company Name",
  "gstin": "27NEWCO5678G2A1",
  "address": "New Address",
  "contact": "9999999999",
  "email": "new@email.com"
}
```

### 4. **DELETE** - Remove Debtor
```
DELETE /clients/{client_id}/sundry-debtors/{debtor_id}
```

**Response**:
```json
{
  "message": "Sundry debtor deleted successfully"
}
```

## 🎯 Usage Flow

### 1. Setup (One-time)
1. Go to **Settings** → **Sundry Debtors**
2. Click **Add Debtor**
3. Fill in customer details:
   - Debtor Name (Required)
   - GSTIN (Required)
   - Address, Contact, Email (Optional)
4. Click **Save**

### 2. Using in B2B Sales
1. Go to **Sales** → **B2B** → **Add B2B**
2. Start typing in **Customer Name** field
3. Dropdown shows matching debtors
4. Click on a suggestion
5. **Name** and **GSTIN** auto-filled!

### 3. Managing Debtors
- **View**: See all debtors in table format
- **Search**: Filter by name or GSTIN
- **Edit**: Click ✏️ icon to update
- **Delete**: Click 🗑️ icon to remove

## 💾 Data Validation

### GSTIN Validation
```javascript
// Format: 15 characters, specific pattern
const gstinRegex = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;
```

### Rules
- ✅ GSTIN must be exactly 15 characters
- ✅ GSTIN must be unique (no duplicates)
- ✅ Debtor name is required
- ✅ Address, contact, email are optional

## 🔒 Constraints

1. **Primary Key**: `id` (UUID)
2. **Unique**: `gstin` (cannot have duplicate GSTINs)
3. **Not Null**: `debtor_name`, `gstin`
4. **Nullable**: `address`, `contact`, `email`

## 📈 Performance

### Indexes
```sql
CREATE INDEX idx_debtor_name ON sundry_debtors(debtor_name);
CREATE INDEX idx_debtor_gstin ON sundry_debtors(gstin);
CREATE INDEX idx_debtor_created ON sundry_debtors(created_at DESC);
```

### Benefits
- Fast name-based searches
- Quick GSTIN lookups
- Efficient sorting by date

## 🛠️ Maintenance

### Backup Debtors
```sql
-- Export all data
SELECT * FROM sundry_debtors;
```

### Clean Up
```sql
-- Remove debtors without contact info
DELETE FROM sundry_debtors 
WHERE contact IS NULL AND email IS NULL;
```

### Statistics
```sql
-- Get usage stats
SELECT 
    COUNT(*) as total_debtors,
    COUNT(address) as with_address,
    COUNT(contact) as with_contact,
    COUNT(email) as with_email
FROM sundry_debtors;
```

## 📊 Example Data

```sql
INSERT INTO sundry_debtors VALUES 
(
    '550e8400-e29b-41d4-a716-446655440001',
    'Global Trading Corporation',
    '24GLBTR9012H3B2',
    'Plot 456, Industrial Area, Ahmedabad, Gujarat',
    '9123456789',
    'info@globaltrading.com',
    '2025-10-21 10:30:00',
    '2025-10-21 10:30:00'
);
```

## 🚀 Integration with B2B Sales

When a debtor is selected from autocomplete:
```javascript
{
  customerGSTIN: debtor.gstin,      // Auto-filled
  customerName: debtor.debtorName,  // Auto-filled
  // User continues with invoice details...
}
```

## ⚠️ Important Notes

1. Each **client** has a separate `sundry_debtors` table
2. GSTIN is **unique** per client database
3. Data is **persistent** across sessions
4. Changes are **immediately saved** to SQLite
5. Auto-fill works **instantly** after adding debtors
6. Table is **automatically created** when client is added

## 📚 State Codes Reference

| Code | State | Code | State |
|------|-------|------|-------|
| 01 | Jammu & Kashmir | 19 | West Bengal |
| 02 | Himachal Pradesh | 20 | Jharkhand |
| 03 | Punjab | 21 | Odisha |
| 07 | Delhi | 22 | Chhattisgarh |
| 09 | Uttar Pradesh | 23 | Madhya Pradesh |
| 24 | Gujarat | 27 | Maharashtra |
| 29 | Karnataka | 32 | Kerala |
| 33 | Tamil Nadu | 36 | Telangana |
| 37 | Andhra Pradesh | 97 | Other Territory |

## 🎓 Quick Start Example

```bash
# 1. Start backend
cd backend
python app.py

# 2. Access in UI
# - Open app
# - Select client
# - Go to Settings → Sundry Debtors
# - Add your first debtor
# - Use in B2B Sales!
```

---

**Version**: 1.0  
**Last Updated**: October 21, 2025  
**Database**: SQLite 3  
**Location**: `backend/client_databases/[client_name].db`

